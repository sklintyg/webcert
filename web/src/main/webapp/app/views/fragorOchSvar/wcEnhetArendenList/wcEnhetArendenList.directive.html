<div>

  <div ng-show="totalCount > 0"> <!-- NOTE: must be ng-show since event from vardenhetfilter is sent to filter controller which doesnt exist with ng-if -->
    <h2 class="page-heading1"  ng-class="{'less-top-padding' : vardenhetFilterModel.units.length < 3}">
      Ärenden visas för {{ selectedUnitName }}
    </h2>
    <wc-enhet-arenden-filter></wc-enhet-arenden-filter>
  </div>

  <!-- loading animation table result -->
  <wc-spinner label="info.running.query" show-spinner="listModel.viewState.runningQuery">

    <div class="arende-table-section">

      <!-- error message -->
      <wc-alert-message id="current-list-noResults-error" ng-show="listModel.viewState.activeErrorMessageKey"
                        alert-severity="danger"
                        alert-message-id="{{listModel.viewState.activeErrorMessageKey}}"></wc-alert-message>

      <wc-no-arenden-message ng-if="totalCount == 0"></wc-no-arenden-message>

      <!-- Search hits -->
      <div id="showing-nr-hits" ng-show="listModel.totalCount > 0">Visar
        1 - {{listModel.arendenList.length}} av
        {{listModel.totalCount}} träff<span ng-show="listModel.totalCount > 1">ar</span>
      </div>

      <!-- arende table - Frågor och svar-tabell -->
      <div class="row" id="arendeTable" ng-show="totalCount > 0">
        <div class="col-md-12">
          <div class="rounded-table-wrapper full-width">
          <table class="table table-striped wc-table-striped">
            <thead>
            <tr>
              <th wc-table-head label-key="th.label.arende-action" help-key="th.help.arende-action"
                  sorting="true" sorting-current="orderBy == 'amne'" sorting-ascending="orderAscending" ng-click="orderByProperty('amne')"></th>
              <th wc-table-head label-key="th.label.arende-sender" help-key="th.help.arende-sender"
                  sorting="true" sorting-current="orderBy == 'fragestallare'" sorting-ascending="orderAscending" ng-click="orderByProperty('fragestallare')"></th>
              <th wc-table-head label-key="th.label.arende-patient" help-key="th.help.arende-patient"
                  sorting="true" sorting-current="orderBy == 'patientId'" sorting-ascending="orderAscending" ng-click="orderByProperty('patientId')"></th>
              <th wc-table-head label-key="th.label.arende-signed-by" help-key="th.help.arende-signed-by"
                  sorting="true" sorting-current="orderBy == 'signeratAvNamn'" sorting-ascending="orderAscending" ng-click="orderByProperty('signeratAvNamn')"></th>
              <th wc-table-head label-key="th.label.arende-sent-recv-date" help-key="th.help.arende-sent-recv-date"
                  sorting="true" sorting-current="orderBy == 'receivedDate'" sorting-ascending="orderAscending" ng-click="orderByProperty('receivedDate')"></th>
              <th wc-table-head label-key="th.label.arende-forwarded" help-key="th.help.arende-forwarded"
                  sorting="true" sorting-current="orderBy == 'vidarebefodrad'" sorting-ascending="orderAscending" class="center"
                  ng-click="orderByProperty('vidarebefodrad')"></th>
              <th></th>
              <th></th>
            </tr>
            </thead>
            <tbody>
            <tr ng-repeat="arende in listModel.arendenList">
              <td><span ng-show="arende.paminnelse">Påminnelse:</span> <span dynamic-label key="arende.measure.{{arende.measureResKey}}"></span></td>
              <td><span dynamic-label key="common.arende.fragestallare.{{arende.fragestallare}}"></span></td>
              <td id="patientId-{{arende.meddelandeId}}" class="unbreakable">{{arende.patientId | PersonIdFormatter}} <i class="material-icons md-18" 
                uib-popover="Patienten har en sekretessmarkering."  popover-popup-delay="300" popover-append-to-body="true"
                popover-placement="auto top" ng-if="arende.sekretessmarkering">security</i></td>
              <td>{{arende.signeratAvNamn}}</td>
              <td class="unbreakable">{{arende.receivedDate | date:'short'}}</td>
              <td class="center">
                <div wc-authority="VIDAREBEFORDRA_FRAGASVAR" intygstyp="{{::arende.intygTyp}}" class="center">
                  <div ng-if="arende.vidarebefordrad"><i class="material-icons">check</i></div>
                </div>
              </td>
              <td>
                <button type="button"
                        class="btn btn-primary"
                        uib-popover-html="forwardTooltip"  popover-placement="top" popover-popup-delay="300" popover-append-to-body="true" popover-is-open="mailBtnTooltipShow"
                        ng-click="mailBtnTooltipShow=false;openMailDialog(arende)"
                        wc-authority="VIDAREBEFORDRA_FRAGASVAR" intygstyp="{{::arende.intygTyp}}">
                  <i class="icon-wc-ikon-reply"></i> Vidarebefordra
                </button>
              </td>
              <td>
                <button type="button"
                        class="btn btn-primary"
                        uib-popover-html="openTooltip"  popover-placement="top" popover-popup-delay="300" popover-append-to-body="true" popover-is-open="openIntygBtnTooltipShow"
                        ng-click="openIntygBtnTooltipShow=false;openIntyg(arende.intygId, arende.intygTyp)"
                        id="showarendeBtn-{{arende.meddelandeId}}"
                  ><i class="icon-wc-ikon-19"></i> <span>Öppna</span></button>
              </td>
            </tr>
          </table>
        </div>
       </div>
      </div>
      <div ng-if="listModel.totalCount == 0 && totalCount > 0">Inga resultat att visa.</div>
      <div ng-show="listModel.arendenList.length < listModel.totalCount">
        <wc-button
            btn-id="hamtaFler"
            btn-class="btn-primary"
            btn-click="fetchMore()"
            loading="listModel.fetchingMoreInProgress"
            btn-tooltip="{{moreHitsTooltip}}">
          Visa fler träffar
        </wc-button>
      </div>
    </div>
  </wc-spinner>
</div>
