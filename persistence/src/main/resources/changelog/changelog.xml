<?xml version="1.0" encoding="UTF-8"?>
<!--
  ~ Copyright (C) 2025 Inera AB (http://www.inera.se)
  ~
  ~ This file is part of sklintyg (https://github.com/sklintyg).
  ~
  ~ sklintyg is free software: you can redistribute it and/or modify
  ~ it under the terms of the GNU General Public License as published by
  ~ the Free Software Foundation, either version 3 of the License, or
  ~ (at your option) any later version.
  ~
  ~ sklintyg is distributed in the hope that it will be useful,
  ~ but WITHOUT ANY WARRANTY; without even the implied warranty of
  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
  ~ GNU General Public License for more details.
  ~
  ~ You should have received a copy of the GNU General Public License
  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.
  -->

<databaseChangeLog xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd"
    logicalFilePath="classpath:changelog/changelog.xml">

  <changeSet id="1" author="me">
    <validCheckSum>8:d1acc338ee58fe8bb295ea314c06a027</validCheckSum>
    <createTable tableName="FRAGASVAR">
      <column name="internReferens" type="bigint" autoIncrement="true">
        <constraints unique="true" nullable="false"/>
      </column>
      <column name="AMNE" type="varchar(255)">
        <constraints nullable="false"/>
      </column>
      <column name="EXTERN_REFERENS" type="varchar(255)">
        <constraints nullable="true"/>
      </column>
      <column name="FRAGE_SIGNERINGS_DATUM" type="datetime">
        <constraints nullable="true"/>
      </column>
      <column name="FRAGE_SKICKAD_DATUM" type="datetime">
        <constraints nullable="true"/>
      </column>
      <column name="FRAGE_STALLARE" type="varchar(255)">
        <constraints nullable="true"/>
      </column>

      <column name="FRAGE_TEXT" type="text">
        <constraints nullable="true"/>
      </column>
      <column name="INTYGS_ID" type="varchar(255)">
        <constraints nullable="true"/>
      </column>
      <column name="INTYGS_TYP" type="varchar(255)">
        <constraints nullable="true"/>
      </column>
      <column name="PATIENT_NAMN" type="varchar(255)">
        <constraints nullable="true"/>
      </column>
      <column name="PATIENT_ID_ROOT" type="varchar(255)">
        <constraints nullable="true"/>
      </column>
      <column name="PATIENT_ID_EXTENSION" type="varchar(255)">
        <constraints nullable="true"/>
      </column>

      <column name="SIGNERINGS_DATUM" type="datetime">
        <constraints nullable="true"/>
      </column>
      <column name="MEDDELANDE_RUBRIK" type="varchar(255)">
        <constraints nullable="true"/>
      </column>
      <column name="SISTA_DATUM_FOR_SVAR" type="date">
        <constraints nullable="true"/>
      </column>
      <column name="SVAR_SIGNERINGS_DATUM" type="datetime">
        <constraints nullable="true"/>
      </column>
      <column name="SVAR_SKICKAD_DATUM" type="datetime">
        <constraints nullable="true"/>
      </column>
      <column name="SENASTE_HANDELSE" type="datetime">
        <constraints nullable="true"/>
      </column>

      <column name="SVARS_TEXT" type="text">
        <constraints nullable="true"/>
      </column>
      <column name="ARBETSPLATS_KOD" type="varchar(255)">
        <constraints nullable="true"/>
      </column>
      <column name="ENHETS_ID" type="varchar(255)">
        <constraints nullable="true"/>
      </column>
      <column name="ENHETSNAMN" type="varchar(255)">
        <constraints nullable="true"/>
      </column>
      <column name="EPOST" type="varchar(255)">
        <constraints nullable="true"/>
      </column>
      <column name="FORSKRIVAR_KOD" type="varchar(255)">
        <constraints nullable="true"/>
      </column>

      <column name="HSAID" type="varchar(255)">
        <constraints nullable="true"/>
      </column>
      <column name="NAMN" type="varchar(255)">
        <constraints nullable="true"/>
      </column>
      <column name="POSTADRESS" type="varchar(255)">
        <constraints nullable="true"/>
      </column>
      <column name="POSTNUMMER" type="varchar(255)">
        <constraints nullable="true"/>
      </column>
      <column name="POSTORT" type="varchar(255)">
        <constraints nullable="true"/>
      </column>
      <column name="TELEFONNUMMER" type="varchar(255)">
        <constraints nullable="true"/>
      </column>

      <column name="VARDGIVAR_ID" type="varchar(255)">
        <constraints nullable="true"/>
      </column>
      <column name="VARDGIVARNAMN" type="varchar(255)">
        <constraints nullable="true"/>
      </column>
      <column name="STATUS" type="varchar(32)">
        <constraints nullable="false"/>
      </column>
      <column name="VIDAREBEFORDRAD" type="boolean">
        <constraints nullable="false"/>
      </column>
      <column name="VARD_AKTOR_HSAID" type="varchar(255)">
        <constraints nullable="true"/>
      </column>
      <column name="VARD_AKTOR_NAMN" type="varchar(255)">
        <constraints nullable="true"/>
      </column>

    </createTable>

    <createTable tableName="KOMPLETTERING">
      <column name="FRAGASVAR_ID" type="bigint">
        <constraints nullable="false"/>
      </column>
      <column name="FALT" type="varchar(255)">
        <constraints nullable="false"/>
      </column>
      <column name="TEXT" type="varchar(255)">
        <constraints nullable="false"/>
      </column>
    </createTable>

    <addForeignKeyConstraint baseColumnNames="FRAGASVAR_ID"
        baseTableName="KOMPLETTERING" constraintName="KOMPLETTERING_FRAGASVAR_FK"
        referencedColumnNames="internReferens" referencedTableName="FRAGASVAR"/>

    <createTable tableName="EXTERNA_KONTAKTER">
      <column name="FRAGASVAR_ID" type="bigint">
        <constraints nullable="false"/>
      </column>
      <column name="KONTAKT" type="varchar(255)">
        <constraints nullable="false"/>
      </column>
    </createTable>

    <addForeignKeyConstraint baseColumnNames="FRAGASVAR_ID"
        baseTableName="EXTERNA_KONTAKTER" constraintName="EXTERNA_KONTAKTER_FRAGASVAR_FK"
        referencedColumnNames="internReferens" referencedTableName="FRAGASVAR"/>

  </changeSet>

  <changeSet id="2" author="np">
    <createTable tableName="MIGRERADE_INTYG_FRAN_MEDCERT">
      <column name="INTYG_ID" type="varchar(255)">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="ENHETS_ID" type="varchar(255)">
        <constraints nullable="false"/>
      </column>
      <column name="INTYGS_TYP" type="varchar(255)">
        <constraints nullable="true"/>
      </column>
      <column name="PATIENT_NAMN" type="varchar(255)">
        <constraints nullable="false"/>
      </column>
      <column name="PATIENT_SSN" type="varchar(255)">
        <constraints nullable="false"/>
      </column>
      <column name="SKAPAD_DATUM" type="datetime">
        <constraints nullable="false"/>
      </column>
      <column name="SKICKAD_DATUM" type="datetime">
        <constraints nullable="true"/>
      </column>
      <column name="MIGRERAD_DATUM" type="datetime">
        <constraints nullable="false"/>
      </column>
      <column name="MIGRERAD_FRAN" type="varchar(25)">
        <constraints nullable="false"/>
      </column>
      <column name="URSPRUNG" type="varchar(255)">
        <constraints nullable="true"/>
      </column>
      <column name="INTYGS_DATA" type="blob">
        <constraints nullable="true"/>
      </column>
      <column name="STATUS" type="varchar(32)">
        <constraints nullable="false"/>
      </column>
    </createTable>
  </changeSet>

  <changeSet id="3" author="bb">
    <createIndex indexName="IDX_FRAGASVAR_INTYGS_ID"
        tableName="FRAGASVAR" unique="false">
      <column name="INTYGS_ID"/>
    </createIndex>
    <createIndex indexName="IDX_FRAGASVAR_ENHETS_ID_STATUS"
        tableName="FRAGASVAR" unique="false">
      <column name="ENHETS_ID"/>
      <column name="STATUS"/>
    </createIndex>
  </changeSet>

  <changeSet id="4" author="np">
    <!-- Change data type -->
    <modifyDataType tableName="KOMPLETTERING" columnName="TEXT"
        newDataType="text"/>
    <!-- Re-apply not null constraint that was lost during data type change -->
    <addNotNullConstraint tableName="KOMPLETTERING"
        columnName="TEXT" columnDataType="text"/>
  </changeSet>

  <!-- Below is 3.0 + -->

  <changeSet id="5" author="mc">
    <createTable tableName="INTYG">
      <column name="INTYGS_ID" type="varchar(64)">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="INTYGS_TYP" type="varchar(255)">
        <constraints nullable="false"/>
      </column>
      <column name="ENHETS_ID" type="varchar(255)">
        <constraints nullable="true"/>
      </column>
      <column name="ENHETS_NAMN" type="varchar(255)">
        <constraints nullable="true"/>
      </column>
      <column name="VARDGIVAR_ID" type="varchar(255)">
        <constraints nullable="true"/>
      </column>
      <column name="VARDGIVAR_NAMN" type="varchar(255)">
        <constraints nullable="true"/>
      </column>
      <column name="PATIENT_PERSONNUMMER" type="varchar(255)">
        <constraints nullable="false"/>
      </column>
      <column name="PATIENT_FORNAMN" type="varchar(255)">
        <constraints nullable="false"/>
      </column>
      <column name="PATIENT_MELLANNAMN" type="varchar(255)">
        <constraints nullable="true"/>
      </column>
      <column name="PATIENT_EFTERNAMN" type="varchar(255)">
        <constraints nullable="false"/>
      </column>
      <column name="SENAST_SPARAD_DATUM" type="datetime">
        <constraints nullable="false"/>
      </column>
      <column name="MODEL" type="blob">
        <constraints nullable="true"/>
      </column>
      <column name="STATUS" type="varchar(32)">
        <constraints nullable="false"/>
      </column>
      <column name="SKAPAD_AV_HSAID" type="varchar(255)">
        <constraints nullable="false"/>
      </column>
      <column name="SKAPAD_AV_NAMN" type="varchar(255)">
        <constraints nullable="false"/>
      </column>
      <column name="SENAST_SPARAD_AV_HSAID" type="varchar(255)">
        <constraints nullable="false"/>
      </column>
      <column name="SENAST_SPARAD_AV_NAMN" type="varchar(255)">
        <constraints nullable="false"/>
      </column>
      <column name="VIDAREBEFORDRAD" type="boolean">
        <constraints nullable="false"/>
      </column>
    </createTable>
  </changeSet>

  <changeSet id="6" author="ps">
    <createTable tableName="SIGNATUR">
      <column name="INTYG_ID" type="varchar(64)">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="SIGNERINGS_DATUM" type="datetime">
        <constraints nullable="true"/>
      </column>
      <column name="SIGNERAD_AV" type="varchar(255)">
        <constraints nullable="false"/>
      </column>
      <column name="INTYG_DATA" type="clob">
        <constraints nullable="false"/>
      </column>
      <column name="INTYG_HASH" type="clob">
        <constraints nullable="false"/>
      </column>
      <column name="SIGNATUR_DATA" type="clob">
        <constraints nullable="false"/>
      </column>
    </createTable>

    <addForeignKeyConstraint constraintName="SIGNATUR_INTYG_FK"
        baseColumnNames="INTYG_ID" baseTableName="SIGNATUR"
        referencedColumnNames="INTYGS_ID" referencedTableName="INTYG"/>

  </changeSet>

  <changeSet id="7" author="rl">
    <validCheckSum>8:e76d02495f91c646c2f5deb7891ffd69</validCheckSum>
    <createTable tableName="OMSANDNING">
      <column name="OMSANDNING_ID" type="bigint" autoIncrement="true">
        <constraints unique="true" nullable="false"/>
      </column>
      <column name="INTYG_ID" type="varchar(64)">
        <constraints nullable="false"/>
      </column>
      <column name="NASTA_FORSOK" type="datetime">
        <constraints nullable="false"/>
      </column>
      <column name="ANTAL_FORSOK" type="int">
        <constraints nullable="false"/>
      </column>
      <column name="GALLRINGSDATUM" type="datetime">
        <constraints nullable="true"/>
      </column>
      <column name="OPERATION" type="varchar(32)">
        <constraints nullable="false"/>
      </column>
      <column name="KONFIGURATION" type="clob">
        <constraints nullable="true"/>
      </column>
    </createTable>
  </changeSet>

  <changeSet id="8" author="np">
    <createTable tableName="INTEGRERADE_VARDENHETER">
      <column name="ENHETS_ID" type="varchar(32)">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="ENHETS_NAMN" type="varchar(255)">
        <constraints nullable="false"/>
      </column>
      <column name="VARDGIVAR_ID" type="varchar(32)">
        <constraints nullable="false"/>
      </column>
      <column name="VARDGIVAR_NAMN" type="varchar(255)">
        <constraints nullable="false"/>
      </column>
      <column name="SKAPAD_DATUM" type="datetime">
        <constraints nullable="false"/>
      </column>
      <column name="SENASTE_KONTROLL_DATUM" type="datetime">
        <constraints nullable="true"/>
      </column>
    </createTable>
  </changeSet>

  <changeSet id="9" author="bb">
    <addColumn tableName="OMSANDNING">
      <column name="INTYG_TYP" type="varchar(255)" defaultValue="fk7263">
        <constraints nullable="false"/>
      </column>
    </addColumn>
  </changeSet>

  <changeSet id="10" author="np">
    <createIndex tableName="INTYG" indexName="IDX_INTYG_ENHETS_ID_STATUS" unique="false">
      <column name="ENHETS_ID"/>
      <column name="STATUS"/>
    </createIndex>
    <createIndex tableName="INTYG" indexName="IDX_INTYG_PATIENT_PERSONNUMMER" unique="false">
      <column name="PATIENT_PERSONNUMMER"/>
    </createIndex>
  </changeSet>

  <changeSet id="11" author="bb">
    <addColumn tableName="INTYG">
      <column name="VERSION" type="bigint" defaultValue="0">
        <constraints nullable="false"/>
      </column>
    </addColumn>
  </changeSet>

  <changeSet id="12" author="me">
    <dropColumn tableName="FRAGASVAR" columnName="PATIENT_ID_ROOT"/>
    <renameColumn tableName="FRAGASVAR" columnDataType="varchar(255)" oldColumnName="PATIENT_ID_EXTENSION" newColumnName="PATIENT_ID"/>
  </changeSet>

  <changeSet id="13" author="bb">
    <addColumn tableName="OMSANDNING">
      <column name="VERSION" type="bigint" defaultValue="0">
        <constraints nullable="false"/>
      </column>
      <column name="BEARBETAS" type="boolean">
        <constraints nullable="false"/>
      </column>
    </addColumn>
  </changeSet>

  <changeSet id="14" author="bb">
    <dropColumn tableName="OMSANDNING" columnName="VERSION"/>
    <dropColumn tableName="OMSANDNING" columnName="BEARBETAS"/>
  </changeSet>

  <changeSet id="15" author="bb">
    <createTable tableName="SCHEDULERAT_JOBB">
      <column name="JOBB_ID" type="varchar(32)">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="VERSION" type="bigint" defaultValue="0">
        <constraints nullable="false"/>
      </column>
      <column name="BEARBETAS" type="boolean">
        <constraints nullable="false"/>
      </column>
    </createTable>
  </changeSet>

  <changeSet id="16" author="el">
    <addColumn tableName="INTYG">
      <column name="SKICKAD_TILL_MOTTAGARE_DATUM" type="datetime">
        <constraints nullable="true"/>
      </column>
      <column name="ATERKALLAD_DATUM" type="datetime">
        <constraints nullable="true"/>
      </column>
      <column name="SKICKAD_TILL_MOTTAGARE" type="varchar(255)">
        <constraints nullable="true"/>
      </column>
    </addColumn>
  </changeSet>

  <changeSet id="17" author="el">
    <dropTable cascadeConstraints="true"
        tableName="OMSANDNING"/>
  </changeSet>

  <changeSet id="18" author="el">
    <validCheckSum>8:2342f23beb363e33fe9733b7ea47669f</validCheckSum>
    <createTable tableName="AVTAL_PRIVATLAKARE">
      <column name="AVTAL_VERSION" type="bigint" autoIncrement="true">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="AVTAL_TEXT" type="text">
        <constraints nullable="false"/>
      </column>
    </createTable>

    <createTable tableName="GODKANT_AVTAL_PRIVATLAKARE">
      <column name="INTERNREFERENS" type="bigint" defaultValue="0">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="AVTAL_VERSION" type="bigint">
        <constraints nullable="false"/>
      </column>
      <column name="HSA_ID" type="varchar(255)">
        <constraints nullable="false"/>
      </column>
      <column name="GODKAND_DATUM" type="datetime">
        <constraints nullable="false"/>
      </column>
    </createTable>

    <addUniqueConstraint
        columnNames="AVTAL_VERSION, HSA_ID"
        constraintName="GODKANT_AVTAL_UNIQUE_CONST"
        tableName="GODKANT_AVTAL_PRIVATLAKARE"/>
  </changeSet>

  <changeSet id="19" author="el">
    <addColumn tableName="AVTAL_PRIVATLAKARE">
      <column name="VERSION_DATUM" type="datetime">
        <constraints nullable="false"/>
      </column>
    </addColumn>
  </changeSet>

  <changeSet id="20" author="me">
    <createTable tableName="ROLLER">
      <column name="ID" type="bigint" autoIncrement="true">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="NAMN" type="varchar(64)">
        <constraints unique="true" nullable="false"/>
      </column>
      <column name="TEXT" type="varchar(255)">
        <constraints nullable="false"/>
      </column>
    </createTable>

    <createTable tableName="RATTIGHETER">
      <column name="ID" type="bigint" autoIncrement="true">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="NAMN" type="varchar(64)">
        <constraints unique="true" nullable="false"/>
      </column>
      <column name="TEXT" type="varchar(255)">
        <constraints nullable="false"/>
      </column>
    </createTable>

    <createTable tableName="ROLLER_RATTIGHETER">
      <column name="ROLL_ID" type="bigint">
        <constraints nullable="false"/>
      </column>
      <column name="RATTIGHET_ID" type="bigint">
        <constraints nullable="false"/>
      </column>
    </createTable>
  </changeSet>

  <changeSet id="21" author="fe">
    <validCheckSum>8:7efcb60ddab035ebd02b1a1d996267bb</validCheckSum>
    <createTable tableName="FMB">
      <column name="ID" type="bigint" autoIncrement="true">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="ICD10" type="varchar(6)">
        <constraints nullable="false"/>
      </column>
      <column name="TYP" type="varchar(64)">
        <constraints nullable="false"/>
      </column>
      <column name="URSPRUNG" type="varchar(64)">
        <constraints nullable="false"/>
      </column>
      <column name="TEXT" type="text">
        <constraints nullable="false"/>
      </column>
      <column name="SENAST_UPPDATERAD" type="varchar(64)">
        <constraints nullable="false"/>
      </column>
    </createTable>
  </changeSet>

  <changeSet id="22" author="me">
    <createTable tableName="BEFATTNINGSKODER">
      <column name="ID" type="bigint" autoIncrement="true">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="BEFATTNINGSKOD" type="varchar(64)">
        <constraints nullable="false"/>
      </column>
      <column name="GRUPPFORSKRIVARKOD" type="varchar(64)">
        <constraints nullable="false"/>
      </column>
    </createTable>

    <addUniqueConstraint
        columnNames="BEFATTNINGSKOD, GRUPPFORSKRIVARKOD"
        constraintName="BEFATTNINGSKOD_GRUPPFORSKRIVARKOD_UNIQUE_CONST"
        tableName="BEFATTNINGSKODER"/>

  </changeSet>

  <changeSet id="23" author="el">
    <createTable tableName="BEFATTNINGSKODER_ROLL">
      <column name="BEFATTNINGSKOD_ID" type="bigint">
        <constraints nullable="false"/>
      </column>
      <column name="ROLL_ID" type="bigint">
        <constraints nullable="false"/>
      </column>
    </createTable>

    <addForeignKeyConstraint constraintName="BEFATTNINGSKODER_ROLL_ROLL_FK"
        baseColumnNames="ROLL_ID" baseTableName="BEFATTNINGSKODER_ROLL"
        referencedColumnNames="ID" referencedTableName="ROLLER"/>

    <addForeignKeyConstraint constraintName="BEFATTNINGSKODER_ROLL_BEFATTNINGSKOD_FK"
        baseColumnNames="BEFATTNINGSKOD_ID" baseTableName="BEFATTNINGSKODER_ROLL"
        referencedColumnNames="ID" referencedTableName="BEFATTNINGSKODER"/>

    <addUniqueConstraint
        columnNames="BEFATTNINGSKOD_ID, ROLL_ID"
        constraintName="BEFATTNINGSKOD_ROLL_UNIQUE_CONST"
        tableName="BEFATTNINGSKODER_ROLL"/>
  </changeSet>

  <changeSet id="24" author="ka">
    <validCheckSum>8:50144fa5562070c8ba67d9efbe2296dd</validCheckSum>
    <createTable tableName="ARENDE">
      <column name="ID" type="bigint" autoIncrement="true">
        <constraints unique="true" nullable="false"/>
      </column>
      <column name="TIMESTAMP" type="datetime">
        <constraints nullable="false"/>
      </column>
      <column name="MEDDELANDE_ID" type="varchar(255)">
      </column>
      <column name="REFERENS_ID" type="varchar(255)">
      </column>
      <column name="SKICKAT_TIDPUNKT" type="datetime">
      </column>
      <column name="SKICKAT_AV" type="varchar(255)">
      </column>
      <column name="INTYGS_ID" type="varchar(255)">
        <constraints nullable="false"/>
      </column>
      <column name="PATIENT_PERSON_ID" type="varchar(255)">
        <constraints nullable="false"/>
      </column>
      <column name="AMNE" type="varchar(255)">
      </column>
      <column name="RUBRIK" type="varchar(255)">
      </column>
      <column name="MEDDELANDE" type="text">
      </column>
      <column name="PAMINNELSE_MEDDELANDE_ID" type="varchar(255)">
      </column>
      <column name="SVAR_PA_ID" type="varchar(255)">
      </column>
      <column name="SVAR_PA_REFERENS" type="varchar(255)">
      </column>
      <column name="SISTA_DATUM_FOR_SVAR" type="date">
      </column>
    </createTable>

    <createTable tableName="MEDICINSKT_ARENDE">
      <column name="ARENDE_ID" type="bigint">
        <constraints nullable="false"/>
      </column>
      <column name="FRAGE_ID" type="varchar(255)">
        <constraints nullable="false"/>
      </column>
      <column name="INSTANS" type="int">
      </column>
      <column name="TEXT" type="varchar(255)">
        <constraints nullable="false"/>
      </column>
    </createTable>

    <addForeignKeyConstraint baseColumnNames="ARENDE_ID"
        baseTableName="MEDICINSKT_ARENDE" constraintName="MEDICINST_ARENDE_ARENDE"
        referencedColumnNames="ID" referencedTableName="ARENDE"/>

    <createTable tableName="ARENDE_KONTAKT_INFO">
      <column name="ARENDE_ID" type="bigint">
        <constraints nullable="false"/>
      </column>
      <column name="KONTAKT_INFO" type="varchar(255)">
        <constraints nullable="false"/>
      </column>
    </createTable>

    <addForeignKeyConstraint baseColumnNames="ARENDE_ID"
        baseTableName="ARENDE_KONTAKT_INFO" constraintName="ARENDE_KONTAKT_INFO_ARENDE"
        referencedColumnNames="ID" referencedTableName="ARENDE"/>

    <createIndex indexName="IDX_ARENDE_INTYGS_ID"
        tableName="ARENDE" unique="false">
      <column name="INTYGS_ID"/>
    </createIndex>

    <createIndex indexName="IDX_ARENDE_TIMESTAMP"
        tableName="ARENDE" unique="false">
      <column name="TIMESTAMP"/>
    </createIndex>

  </changeSet>

  <changeSet id="25" author="mn">

    <addColumn tableName="ARENDE">
      <column name="INTYG_TYP" type="varchar(255)"/>
      <column name="SIGNERAT_AV" type="varchar(255)"/>
      <column name="ENHET" type="varchar(255)"/>
      <column name="STATUS" type="varchar(32)">
        <constraints nullable="false"/>
      </column>
    </addColumn>

    <createIndex indexName="IDX_ARENDE_ENHET_STATUS"
        tableName="ARENDE" unique="false">
      <column name="ENHET"/>
      <column name="STATUS"/>
    </createIndex>

  </changeSet>

  <changeSet id="26" author="mn">

    <addColumn tableName="INTEGRERADE_VARDENHETER">
      <column name="SCHEMA_VERSION" type="varchar(32)" defaultValue="V1">
        <constraints nullable="false"/>
      </column>
    </addColumn>

  </changeSet>

  <changeSet id="27" author="mn">

    <addColumn tableName="INTYG">
      <column name="RELATION_INTYG_ID" type="varchar(255)"/>
      <column name="RELATION_KOD" type="varchar(32)"/>
    </addColumn>

    <createIndex indexName="IDX_RELATION_KOD_INTYG_ID"
        tableName="INTYG" unique="false">
      <column name="RELATION_INTYG_ID"/>
      <column name="RELATION_KOD"/>
    </createIndex>

  </changeSet>

  <changeSet id="28" author="kja">
    <addColumn tableName="ARENDE">
      <column name="SIGNERAT_AV_NAME" type="varchar(255)"/>
      <column name="VIDAREBEFORDRAD" type="boolean"/>
      <column name="SENASTE_HANDELSE" type="datetime"/>
    </addColumn>
  </changeSet>

  <changeSet id="29" author="me">
    <dropTable tableName="BEFATTNINGSKODER_ROLL"/>
  </changeSet>

  <changeSet id="30" author="me">
    <dropTable tableName="BEFATTNINGSKODER"/>
  </changeSet>

  <changeSet id="31" author="me">
    <dropTable tableName="ROLLER_RATTIGHETER"/>
  </changeSet>

  <changeSet id="32" author="me">
    <dropTable tableName="RATTIGHETER"/>
  </changeSet>

  <changeSet id="33" author="me">
    <dropTable tableName="ROLLER"/>
  </changeSet>

  <changeSet id="34" author="kja">
    <addUniqueConstraint
        columnNames="MEDDELANDE_ID"
        tableName="ARENDE"/>
  </changeSet>

  <changeSet id="35" author="mn">
    <addColumn tableName="ARENDE">
      <column name="VARDAKTOR_NAME" type="varchar(255)"/>
    </addColumn>
  </changeSet>

  <changeSet id="36" author="mc">
    <comment>Update to new FMB TYP constants names</comment>
    <sql>
      UPDATE FMB SET TYP='SYMPTOM_PROGNOS_BEHANDLING' WHERE TYP='FALT2_SPB';
      UPDATE FMB SET TYP='GENERELL_INFO' WHERE TYP='FALT2_GENERAL';
      UPDATE FMB SET TYP='FUNKTIONSNEDSATTNING' WHERE TYP='FALT4';
      UPDATE FMB SET TYP='AKTIVITETSBEGRANSNING' WHERE TYP='FALT5';
      UPDATE FMB SET TYP='BESLUTSUNDERLAG_TEXTUELLT' WHERE TYP='FALT8B';
    </sql>
  </changeSet>

  <changeSet id="37" author="mn">
    <addColumn tableName="ARENDE">
      <column name="ENHET_NAME" type="varchar(255)"/>
      <column name="VARDGIVARE_NAME" type="varchar(255)"/>
    </addColumn>
  </changeSet>

  <changeSet id="38" author="kja">
    <dropColumn tableName="INTEGRERADE_VARDENHETER" columnName="SCHEMA_VERSION"/>

    <addColumn tableName="INTEGRERADE_VARDENHETER">
      <column name="SCHEMA_VERSION_1" type="boolean" defaultValueBoolean="false">
        <constraints nullable="false"/>
      </column>
    </addColumn>

    <addColumn tableName="INTEGRERADE_VARDENHETER">
      <column name="SCHEMA_VERSION_2" type="boolean" defaultValueBoolean="false">
        <constraints nullable="false"/>
      </column>
    </addColumn>
    <sql>
      UPDATE INTEGRERADE_VARDENHETER SET SCHEMA_VERSION_1=true;
    </sql>
  </changeSet>

  <changeSet id="39" author="el">
    <validCheckSum>8:e5aca87c599fa4c71ad7ad4346e89895</validCheckSum>
    <createTable tableName="ANVANDARE_PREFERENCE">
      <column name="INTERNREFERENS" type="bigint" autoIncrement="true">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="HSA_ID" type="varchar(255)">
        <constraints nullable="false"/>
      </column>
      <column name="PREF_KEY" type="varchar(255)">
        <constraints nullable="false"/>
      </column>
      <column name="PREF_VALUE" type="varchar(4096)">
        <constraints nullable="true"/>
      </column>
    </createTable>

    <addUniqueConstraint
        columnNames="HSA_ID, PREF_KEY"
        constraintName="ANVANDARE_PREFERENCE_UNIQUE_CONST"
        tableName="ANVANDARE_PREFERENCE"/>
  </changeSet>

  <changeSet id="40" author="el">
    <createIndex indexName="IDX_ANV_PREF_HSA_ID"
        tableName="ANVANDARE_PREFERENCE" unique="false">
      <column name="HSA_ID"/>
    </createIndex>
  </changeSet>

  <changeSet id="41" author="el">
    <modifyDataType
        columnName="TEXT"
        newDataType="text"
        tableName="MEDICINSKT_ARENDE"/>
  </changeSet>

  <changeSet id="42" author="kja">
    <validCheckSum>8:3b3accb9e618931dc0a4223b52a2361e</validCheckSum>
    <createTable tableName="HANDELSE">
      <column name="ID" type="bigint" autoIncrement="true">
        <constraints unique="true" nullable="false"/>
      </column>
      <column name="TIMESTAMP" type="datetime">
        <constraints nullable="false"/>
      </column>
      <column name="KOD" type="varchar(255)">
        <constraints nullable="false"/>
      </column>
      <column name="INTYGS_ID" type="varchar(255)">
        <constraints nullable="false"/>
      </column>
      <column name="ENHETS_ID" type="varchar(255)">
      </column>
      <column name="VARDGIVAR_ID" type="varchar(255)">
      </column>
      <column name="PATIENT_PERSON_ID" type="varchar(255)">
        <constraints nullable="false"/>
      </column>
      <column name="REFERENCE" type="varchar(255)">
      </column>
    </createTable>
  </changeSet>

  <changeSet id="43" author="el">
    <addColumn tableName="INTYG">
      <column name="KLAR_FOR_SIGNERA_DATUM" type="datetime">
        <constraints nullable="true"/>
      </column>
    </addColumn>
  </changeSet>

  <changeSet id="44" author="cf">
    <renameColumn tableName="INTYG"
        oldColumnName="KLAR_FOR_SIGNERA_DATUM"
        newColumnName="KLART_FOR_SIGNERING_DATUM"
        columnDataType="datetime"/>
  </changeSet>

  <changeSet id="45" author="kja">
    <renameColumn columnDataType="boolean"
        newColumnName="SCHEMA_VERSION_3"
        oldColumnName="SCHEMA_VERSION_2"
        tableName="INTEGRERADE_VARDENHETER"/>
  </changeSet>

  <changeSet id="46" author="kja">
    <addColumn tableName="HANDELSE">
      <column name="SISTA_DATUM_FOR_SVAR" type="date">
        <constraints nullable="true"/>
      </column>
    </addColumn>
    <addColumn tableName="HANDELSE">
      <column name="AMNE" type="varchar(255)">
        <constraints nullable="true"/>
      </column>
    </addColumn>
  </changeSet>

  <changeSet id="47" author="kja">
    <createIndex indexName="IDX_HANDELSE_INTYGS_ID"
        tableName="HANDELSE" unique="false">
      <column name="INTYGS_ID"/>
    </createIndex>
  </changeSet>

  <changeSet id="48" author="kja">
    <validCheckSum>8:885b8794a485837e1aa810a5d458d9e3</validCheckSum>
    <createTable tableName="ARENDE_UTKAST">
      <column name="ID" type="bigint" autoIncrement="true">
        <constraints unique="true" nullable="false"/>
      </column>
      <column name="QUESTION_ID" type="varchar(255)">
        <constraints unique="true"/>
      </column>
      <column name="INTYGS_ID" type="varchar(255)"/>
      <column name="TEXT" type="text"/>
      <column name="AMNE" type="varchar(255)"/>
    </createTable>

    <createIndex tableName="ARENDE_UTKAST" indexName="ARENDE_UTKAST_INTYGS_ID_IDX">
      <column name="INTYGS_ID"/>
      <column name="QUESTION_ID"/>
    </createIndex>
  </changeSet>

  <changeSet id="49" author="kja">
    <preConditions onFail="MARK_RAN">
      <or>
        <dbms type="h2"/>
        <sqlCheck expectedResult="blob">SELECT DATA_TYPE FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'INTYG' AND
          COLUMN_NAME = 'MODEL'
        </sqlCheck>
      </or>
    </preConditions>

    <modifyDataType
        columnName="MODEL"
        newDataType="mediumblob"
        tableName="INTYG"/>
  </changeSet>

  <changeSet id="50" author="kja">
    <dropNotNullConstraint
        columnDataType="varchar(255)"
        columnName="PATIENT_FORNAMN"
        tableName="INTYG"/>
    <dropNotNullConstraint
        columnDataType="varchar(255)"
        columnName="PATIENT_EFTERNAMN"
        tableName="INTYG"/>
  </changeSet>

  <changeSet id="51" author="el">
    <validCheckSum>8:60b4a292719195f5ef752319a115ac3c</validCheckSum>
    <createTable tableName="PAGAENDE_SIGNERING">
      <column name="INTERN_REFERENS" type="bigint" autoIncrement="true">
        <constraints primaryKey="true" unique="true" nullable="false"/>
      </column>
      <column name="INTYG_ID" type="varchar(64)">
        <constraints nullable="false"/>
      </column>
      <column name="SIGNERINGS_DATUM" type="datetime">
        <constraints nullable="false"/>
      </column>
      <column name="SIGNERAD_AV_HSA_ID" type="varchar(255)">
        <constraints nullable="false"/>
      </column>
      <column name="SIGNERAD_AV_NAMN" type="varchar(255)">
        <constraints nullable="false"/>
      </column>
      <column name="INTYG_DATA" type="clob">
        <constraints nullable="false"/>
      </column>
    </createTable>
  </changeSet>

  <changeSet id="52" author="ef">
    <validCheckSum>8:08b546bff288f48ae2b610b12d3f9cb0</validCheckSum>
    <createTable tableName="REFERENS">
      <column name="ID" type="bigint" autoIncrement="true">
        <constraints primaryKey="true" unique="true" nullable="false"/>
      </column>
      <column name="INTYG_ID" type="varchar(64)">
        <constraints nullable="false"/>
      </column>
      <column name="REFERENS" type="varchar(255)">
        <constraints nullable="false"/>
      </column>
    </createTable>

    <createIndex tableName="REFERENS" indexName="INTYG_ID_REFERENS_IDX">
      <column name="INTYG_ID"/>
    </createIndex>

    <sql>
      INSERT INTO REFERENS (INTYG_ID, REFERENS) SELECT a.INTYGS_ID, a.REFERENCE FROM HANDELSE a INNER JOIN (SELECT INTYGS_ID, MIN(TIMESTAMP) TIMESTAMP FROM HANDELSE WHERE REFERENCE IS NOT NULL GROUP BY INTYGS_ID) b ON a.INTYGS_ID = b.INTYGS_ID AND a.TIMESTAMP = b.TIMESTAMP;
    </sql>

    <dropColumn tableName="HANDELSE" columnName="REFERENCE"/>
  </changeSet>

  <changeSet id="53" author="kja">
    <addColumn tableName="INTYG">
      <column name="SKAPAD" type="datetime">
        <constraints nullable="true"/>
      </column>
    </addColumn>
  </changeSet>

  <changeSet id="54" author="el">
    <addColumn tableName="SIGNATUR">
      <column name="SIGNATUR_TYP" type="varchar(64)">
        <constraints nullable="false"/>
      </column>
    </addColumn>
    <sql>UPDATE SIGNATUR SET SIGNATUR_TYP='LEGACY' WHERE SIGNATUR_TYP IS NULL</sql>
  </changeSet>

  <!-- Last changeset sql only worked on H2 -->
  <changeSet id="55" author="el">
    <sql>UPDATE SIGNATUR SET SIGNATUR_TYP='LEGACY' WHERE (SIGNATUR_TYP IS NULL OR SIGNATUR_TYP = '')</sql>
  </changeSet>

  <changeSet id="56" author="ja">
    <validCheckSum>8:31526e8cb427edc3a5fed8c9b8bf2dbf</validCheckSum>
    <createTable tableName="FMB_DIAGNOS_INFORMATION">
      <column name="ID" type="bigint" autoIncrement="true">
        <constraints primaryKey="true" unique="true" nullable="false"/>
      </column>
      <column name="FORSAKRINGSMEDICINSK_INFORMATION" type="varchar(4085)">
        <constraints nullable="false"/>
      </column>
      <column name="SYMPTOM_PROGNOS_BEHANDLING" type="varchar(4085)">
        <constraints nullable="false"/>
      </column>
      <column name="SENAST_UPPDATERAD" type="datetime">
        <constraints nullable="true"/>
      </column>
    </createTable>

    <createTable tableName="FMB_BESKRIVNING">
      <column name="ID" type="bigint" autoIncrement="true">
        <constraints primaryKey="true" unique="true" nullable="false"/>
      </column>
      <column name="TYP" type="varchar(255)">
        <constraints nullable="false"/>
      </column>
      <column name="BESKRIVNING" type="varchar(4095)">
        <constraints nullable="false"/>
      </column>
      <column name="DIAGNOS_INFORMATION_ID" type="bigint">
        <constraints nullable="false"/>
      </column>
    </createTable>

    <addForeignKeyConstraint baseColumnNames="DIAGNOS_INFORMATION_ID"
                             baseTableName="FMB_BESKRIVNING" constraintName="FMB_BESKRIVNING_FMB_DIAGNOS_INFORMATION"
                             referencedColumnNames="ID" referencedTableName="FMB_DIAGNOS_INFORMATION"/>

    <createTable tableName="FMB_ICF_KOD">
      <column name="ID" type="bigint" autoIncrement="true">
        <constraints primaryKey="true" unique="true" nullable="false"/>
      </column>
      <column name="KOD" type="varchar(255)">
        <constraints nullable="false"/>
      </column>
      <column name="TYP" type="varchar(255)">
        <constraints nullable="false"/>
      </column>
      <column name="BESKRIVNING_ID" type="bigint">
        <constraints nullable="false"/>
      </column>
    </createTable>

    <addForeignKeyConstraint baseColumnNames="BESKRIVNING_ID"
                             baseTableName="FMB_ICF_KOD" constraintName="FMB_ICF_KOD_FMB_BESKRIVNING"
                             referencedColumnNames="ID" referencedTableName="FMB_BESKRIVNING"/>

    <createTable tableName="FMB_ICD10_KOD">
      <column name="ID" type="bigint" autoIncrement="true">
        <constraints primaryKey="true" unique="true" nullable="false"/>
      </column>
      <column name="KOD" type="varchar(255)">
        <constraints nullable="false"/>
      </column>
      <column name="BESKRIVNING" type="varchar(1024)">
        <constraints nullable="true"/>
      </column>
      <column name="DIAGNOS_INFORMATION_ID" type="bigint">
        <constraints nullable="false"/>
      </column>
    </createTable>

    <addForeignKeyConstraint baseColumnNames="DIAGNOS_INFORMATION_ID"
                             baseTableName="FMB_ICD10_KOD" constraintName="FMB_ICD10_KOD_FMB_DIAGNOS_INFORMATION"
                             referencedColumnNames="ID" referencedTableName="FMB_DIAGNOS_INFORMATION"/>


    <createTable tableName="FMB_TYPFALL">
      <column name="ID" type="bigint" autoIncrement="true">
        <constraints primaryKey="true" unique="true" nullable="false"/>
      </column>
      <column name="TYPFALLSMENING" type="varchar(1024)">
        <constraints nullable="false"/>
      </column>
      <column name="MAXIMALSJUKRIVNINGSTID" type="bigint">
        <constraints nullable="false"/>
      </column>
      <column name="ICD10_ID" type="bigint">
        <constraints nullable="false"/>
      </column>
    </createTable>

    <addForeignKeyConstraint baseColumnNames="ICD10_ID"
                             baseTableName="FMB_TYPFALL" constraintName="FMB_TYPFALL_FMB_ICD10_ID"
                             referencedColumnNames="ID" referencedTableName="FMB_ICD10_KOD"/>

    <createTable tableName="FMB_REFERENS">
      <column name="ID" type="bigint" autoIncrement="true">
        <constraints primaryKey="true" unique="true" nullable="false"/>
      </column>
      <column name="TEXT" type="varchar(1024)">
        <constraints nullable="true"/>
      </column>
      <column name="URI" type="varchar(1024)">
        <constraints nullable="true"/>
      </column>
      <column name="DIAGNOS_INFORMATION_ID" type="bigint">
        <constraints nullable="false"/>
      </column>
    </createTable>

    <addForeignKeyConstraint baseColumnNames="DIAGNOS_INFORMATION_ID"
                             baseTableName="FMB_REFERENS" constraintName="FMB_REFERENS_FMB_DIAGNOS_INFORMATION"
                             referencedColumnNames="ID" referencedTableName="FMB_DIAGNOS_INFORMATION"/>
  </changeSet>

  <changeSet id="57" author="ja">
    <renameColumn oldColumnName="MAXIMALSJUKRIVNINGSTID"
                  newColumnName="MAXIMALSJUKRIVNINGSTID_DAGAR"
                  tableName="FMB_TYPFALL"
                  columnDataType="bigint"/>

    <modifyDataType tableName="FMB_TYPFALL"
                    columnName="MAXIMALSJUKRIVNINGSTID_DAGAR"
                    newDataType="bigint"/>

    <dropNotNullConstraint tableName="FMB_TYPFALL"
                           columnName="MAXIMALSJUKRIVNINGSTID_DAGAR"
                           columnDataType="bigint"/>
  </changeSet>

  <!-- Add column for intygTypeVersion needed for versioned intyg -->
  <changeSet id="58" author="marced">
    <addColumn tableName="INTYG">
      <column name="INTYG_TYPE_VERSION" type="varchar(32)">
        <constraints nullable="false"/>
      </column>
    </addColumn>
    <!-- NOTE: This need to be verified to work before beiing put into production!!!!
    Since we dont have a simple way of finding out exact version of existing ts
    certificates (they will exist with versions 2.6/2.8 and 6.7/6.8.) we only specify major version (=modelversion) for ts certificates.
    The minor version only matters when resolving texts, while major is important when choosing moduleapi version etc.-->
    <sql>
      UPDATE INTYG SET INTYG_TYPE_VERSION = '1.0' WHERE INTYGS_TYP  NOT IN ('ts-bas', 'ts-diabetes');
      UPDATE INTYG SET INTYG_TYPE_VERSION = '6' WHERE INTYGS_TYP = 'ts-bas';
      UPDATE INTYG SET INTYG_TYPE_VERSION = '2' WHERE INTYGS_TYP = 'ts-diabetes';
    </sql>
  </changeSet>

  <changeSet id="59" author="perbe">
    <addColumn tableName="FMB_DIAGNOS_INFORMATION">
      <column name="INFORMATION_OM_REHABILITERING" type="varchar(4085)">
        <constraints nullable="true"/>
      </column>
    </addColumn>
  </changeSet>

  <changeSet id="60" author="mc">
    <addColumn tableName="FMB_TYPFALL">
      <column name="MAXIMALSJUKRIVNINGSTID_SOURCE_VALUE" type="varchar(10)">
        <constraints nullable="true"/>
      </column>
    </addColumn>
    <addColumn tableName="FMB_TYPFALL">
      <column name="MAXIMALSJUKRIVNINGSTID_SOURCE_UNIT" type="varchar(10)">
        <constraints nullable="true"/>
      </column>
    </addColumn>
  </changeSet>

  <changeSet id="61" author="mc">
    <addColumn tableName="FMB_DIAGNOS_INFORMATION">
      <column name="DIAGNOS_RUBRIK" type="varchar(512)">
        <constraints nullable="true"/>
      </column>
    </addColumn>
  </changeSet>

  <changeSet id="62" author="mww">
    <addColumn tableName="INTYG">
      <column name="TEST_INTYG" type="boolean" defaultValueBoolean="false">
        <constraints nullable="false" />
      </column>
    </addColumn>
    <createIndex indexName="IDX_INTYG_TEST_INTYG"
        tableName="INTYG" unique="false">
      <column name="TEST_INTYG"/>
    </createIndex>
  </changeSet>

  <changeSet id="63" author="mj">
    <addColumn tableName="HANDELSE">
      <column name="HANTERAT_AV" type="varchar(255)">
        <constraints nullable="true"/>
      </column>
    </addColumn>
  </changeSet>

  <changeSet id="64" author="mww">
    <createIndex indexName="IDX_HANDELSE_PATIENT_PERSON_ID"
        tableName="HANDELSE" unique="false">
      <column name="PATIENT_PERSON_ID"/>
    </createIndex>
  </changeSet>

  <changeSet id="65" author="ar">
    <validCheckSum>8:6912c0e4b696d16d86e5f02eac230e61</validCheckSum>
    <createTable tableName="CERTIFICATE_EVENT">
      <column name="ID" type="bigint" autoIncrement="true">
        <constraints primaryKey="true" unique="true" nullable="false"/>
      </column>
      <column name="CERTIFICATE_ID" type="varchar(64)">
        <constraints nullable="false"/>
      </column>
      <column name="USER" type="varchar(255)">
        <constraints nullable="false"/>
      </column>
      <column name="EVENT_CODE" type="varchar(64)">
        <constraints nullable="false"/>
      </column>
      <column name="TIMESTAMP" type="varchar(255)">
        <constraints nullable="false"/>
      </column>
      <column name="MESSAGE" type="varchar(255)">
        <constraints nullable="true"/>
      </column>
    </createTable>

    <createIndex indexName="IDX_CERTIFICATE_EVENT_CERTIFICATE_ID"
        tableName="CERTIFICATE_EVENT" unique="false">
      <column name="CERTIFICATE_ID"/>
    </createIndex>
  </changeSet>


  <changeSet id="66" author="mj">
    <validCheckSum>8:a449087589ef5152cb058f8291a22e89</validCheckSum>
    <createTable tableName="CERTIFICATE_EVENT_FAILED_LOAD">
      <column name="ID" type="bigint" autoIncrement="true">
        <constraints primaryKey="true" unique="true" nullable="false"/>
      </column>
      <column name="CERTIFICATE_ID" type="varchar(64)">
        <constraints nullable="false"/>
      </column>
      <column name="TIMESTAMP" type="varchar(255)">
        <constraints nullable="false"/>
      </column>
      <column name="EXCEPTION" type="CLOB">
        <constraints nullable="true"/>
      </column>
    </createTable>

    <createIndex indexName="IDX_CERTIFICATE_EVENT_FAILED_LOAD_CERTIFICATE_ID"
        tableName="CERTIFICATE_EVENT_FAILED_LOAD" unique="false">
      <column name="CERTIFICATE_ID"/>
    </createIndex>

    <createTable tableName="CERTIFICATE_EVENT_PROCESSED">
      <column name="CERTIFICATE_ID" type="varchar(64)">
        <constraints  primaryKey="true" unique="true" nullable="false"/>
      </column>
    </createTable>
  </changeSet>

  <changeSet id="67" author="mh">
    <createTable tableName="NOTIFICATION_REDELIVERY">
      <column name="HANDELSE_ID" type="bigint">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="CORRELATION_ID" type="varchar(255)">
        <constraints nullable="true"/>
      </column>
      <column name="MESSAGE" type="mediumblob">
        <constraints nullable="true"/>
      </column>
      <column name="REDELIVERY_STRATEGY" type="varchar(255)">
        <constraints nullable="false"/>
      </column>
      <column name="REDELIVERY_TIME" type="datetime">
        <constraints nullable="true"/>
      </column>
      <column name="ATTEMPTED_DELIVERIES" type="int">
        <constraints nullable="true"/>
      </column>
    </createTable>

    <createIndex indexName="IDX_NOTIFICATION_REDELIVERY_REDELIVERY_TIME"
        tableName="NOTIFICATION_REDELIVERY" unique="false">
      <column name="REDELIVERY_TIME"/>
    </createIndex>

    <createIndex indexName="IDX_NOTIFICATION_REDELIVERY_CORRELATION_ID"
        tableName="NOTIFICATION_REDELIVERY" unique="true">
      <column name="CORRELATION_ID"/>
    </createIndex>
  </changeSet>

  <changeSet id="68" author="mh">
    <createTable tableName="HANDELSE_METADATA">
      <column name="HANDELSE_ID" type="bigint">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="DELIVERY_STATUS" type="varchar(255)">
        <constraints nullable="true"/>
      </column>
      <column name="CERTIFICATE_TYPE" type="varchar(255)">
        <constraints nullable="true"/>
      </column>
      <column name="CERTIFICATE_VERSION" type="varchar(255)">
        <constraints nullable="true"/>
      </column>
      <column name="CERTIFICATE_ISSUER" type="varchar(255)">
        <constraints nullable="true"/>
      </column>
    </createTable>
  </changeSet>

  <changeSet id="69" author="mh">
    <addNotNullConstraint tableName="FMB_DIAGNOS_INFORMATION" columnName="FORSAKRINGSMEDICINSK_INFORMATION" columnDataType="text"/>
    <addNotNullConstraint tableName="FMB_DIAGNOS_INFORMATION" columnName="SYMPTOM_PROGNOS_BEHANDLING" columnDataType="text"/>
    <addNotNullConstraint tableName="FMB_BESKRIVNING" columnName="BESKRIVNING" columnDataType="text"/>
    <addNotNullConstraint tableName="FMB_TYPFALL" columnName="TYPFALLSMENING" columnDataType="text"/>
    <modifyDataType tableName="FMB_DIAGNOS_INFORMATION" columnName="INFORMATION_OM_REHABILITERING" newDataType="text"/>
  </changeSet>

  <changeSet id="70" author="mh">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists tableName="INTYG" indexName="IDX_INTYG_VARDGIVAR_ID"/>
      </not>
    </preConditions>
    <createIndex indexName="IDX_INTYG_VARDGIVAR_ID"
        tableName="INTYG" unique="false">
      <column name="VARDGIVAR_ID"/>
    </createIndex>
  </changeSet>

  <changeSet id="71" author="mh">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists tableName="GODKANT_AVTAL_PRIVATLAKARE" indexName="IDX_GODKANT_AVTAL_PRIVATLAKARE_HSA_ID"/>
      </not>
    </preConditions>
    <createIndex indexName="IDX_GODKANT_AVTAL_PRIVATLAKARE_HSA_ID"
        tableName="GODKANT_AVTAL_PRIVATLAKARE" unique="false">
      <column name="HSA_ID"/>
    </createIndex>
  </changeSet>

  <changeSet id="72" author="mh">
    <preConditions onFail="MARK_RAN">
      <not>
        <indexExists tableName="INTEGRERADE_VARDENHETER" indexName="IDX_INTEGRERADE_VARDENHETER_VARDGIVAR_ID"/>
      </not>
    </preConditions>
    <createIndex indexName="IDX_INTEGRERADE_VARDENHETER_VARDGIVAR_ID"
        tableName="INTEGRERADE_VARDENHETER" unique="false">
      <column name="VARDGIVAR_ID"/>
    </createIndex>
  </changeSet>

  <changeSet id="73" author="cs">
    <createIndex indexName="IDX_ARENDE_PATIENT_PERSON_ID_TIMESTAMP"
        tableName="ARENDE" unique="false">
      <column name="PATIENT_PERSON_ID"/>
      <column name="TIMESTAMP"/>
    </createIndex>
  </changeSet>

	<changeSet id="74" author="mgr" runOnChange="false" runAlways="false">
		<validCheckSum>9:80a566df25f2638d9a9a2c997ffeb667</validCheckSum>
		<!--
			This changeset originally attempted to add a UNIQUE constraint on INTYGS_ID,
			which caused failures in some databases (e.g. production).
			It is now deprecated and will be marked as executed without doing anything.
		-->
		<preConditions onFail="MARK_RAN">
			<sqlCheck expectedResult="0">
				SELECT 1 WHERE 1 = 1
			</sqlCheck>
		</preConditions>
	</changeSet>

	<changeSet id="75" author="mww">
		<preConditions onFail="MARK_RAN">
			<sqlCheck expectedResult="1">
				SELECT COUNT(*)
				FROM DATABASECHANGELOG
				WHERE ID = '74'
					AND AUTHOR = 'mgr'
					AND MD5SUM = '9:80a566df25f2638d9a9a2c997ffeb667'
			</sqlCheck>
		</preConditions>

		<dropUniqueConstraint
				tableName="ARENDE_UTKAST"
				constraintName="ARENDE_UTKAST_INTYGS_ID_UNIQUE"/>
	</changeSet>

	<changeSet id="76" author="mww">
		<preConditions onFail="MARK_RAN">
			<dbms type="mysql"/>
		</preConditions>

		<sql>
			ALTER TABLE ARENDE_UTKAST
				ADD COLUMN QUESTION_ID_NORM VARCHAR(255)
					GENERATED ALWAYS AS (IFNULL(QUESTION_ID, '__NULL__')) VIRTUAL;
		</sql>
	</changeSet>

	<changeSet id="77" author="mww">
		<preConditions onFail="MARK_RAN">
			<dbms type="mysql"/>
		</preConditions>

		<createIndex tableName="ARENDE_UTKAST" indexName="ARENDE_UTKAST_INTYGS_ID_QUESTION_ID_NORM_UNIQUE" unique="true">
			<column name="INTYGS_ID"/>
			<column name="QUESTION_ID_NORM"/>
		</createIndex>
	</changeSet>
</databaseChangeLog>
